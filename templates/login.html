{% extends "base.html" %}

{% block content %}
    <div class="container" id='incorrectPassword' style="display: none">
        <div class="row">
            <div class="col">
                <div class="alert alert-danger" role="alert">
                  Incorrect Password!!!
                </div>
            </div>
        </div>
    </div>
    <div class="container">
    {% for password in pw %}
    	{% if loop.index0 % 3 == 0 %}
  		<div class="row">
  		{% endif %}
    		<div class="col">
    			{% if loop.counter == loop.last %}
    				<button class="btn btn-primary btn-lg col-centered" value="{{ password }}">{{ password }}</button>
    			{% else %}
    				<button class="btn btn-primary btn-lg" value="{{ password }}">{{ password }}</button>
  
    			{% endif %}
    		</div>
  		{% if loop.index0 % 3 == 2 or loop.last %}
			</div>
        {% endif %}
   		{% endfor %}
    </div>

{% endblock %}

{% block scripts %}
<script>

	$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
	var codes_array = [];
	var iter = 0;

	$("button").click(function() {
	    codes_array.push(this.value);
        iter += 1;
	    console.log(codes_array);
	    if( iter >= 3) {
	        console.log(iter);
            $.ajax({
                url: $SCRIPT_ROOT + '/submit_login',
                type: "POST",
                data: {
                    code_zero: codes_array[0],
                    code_one: codes_array[1],
                    code_two: codes_array[2]
                },
                success: function (result) {
                    if (result === "True") {
                        window.location.href = '/authenticated/auth';
                    }
                    else {
                        iter = 0;
                        codes_array = [];
                        $("#incorrectPassword").css({"display": "inline-block"});
                        setTimeout(function() {
                            $("#incorrectPassword").css({"display": "none"});
                        }, 1000);
                    }
                }
            });
        }
	});
</script>
{% endblock %}
